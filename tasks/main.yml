---
  - name: Install packages with chocolatey
    win_chocolatey:
      name: '{{ item }}'
      state: present
    with_items:
      - dt-agent
      - dt-console
      - fslogix
    register: sw_installed
      
  - name: Install Printers
    win_shell: |
      if(get-printerdriver -name "Generic / Text Only"){}else{Add-PrinterDriver -Name "Generic / Text Only"}
      if(get-printer -name "Corporate"){}else{Add-Printer -Name "Corporate" -DriverName "Generic / Text Only" -PortName LPT1:}
      if(get-printer -name "Floor 1"){}else{Add-Printer -Name "Floor 1" -DriverName "Generic / Text Only" -PortName LPT2:}
      if(get-printer -name "Floor 2"){}else{Add-Printer -Name "Floor 2" -DriverName "Generic / Text Only" -PortName LPT3:}
    args:
        creates: C:\Logs\done-printer-install.txt

  - name: Copy FSLogix FXA file
    ansible.builtin.copy:
      src: files/NotepadPlusPlus.fxa
      dest: C:\Program Files\FSLogix\Apps\Rules\NotepadPlusPlus.fxa

  - name: Copy FSLogix FXR file
    ansible.builtin.copy:
      src: files/NotepadPlusPlus.fxr
      dest: C:\Program Files\FSLogix\Apps\Rules\NotepadPlusPlus.fxr

  - name: Reboot
    ansible.windows.win_reboot:
    when: sw_installed.changed